{"ast":null,"code":"import { useSafeLayoutEffect } from \"@chakra-ui/hooks\";\nimport { fromEntries } from \"@chakra-ui/utils\";\nimport { createPopper as defaultCreatePopper } from \"@popperjs/core\";\nimport { dequal } from \"dequal\";\nimport * as React from \"react\";\n\nfunction resolve(obj, elements) {\n  return prev => {\n    var next = fromEntries(elements.map(element => [element, obj[element]]));\n    var isPopperEqual = dequal(prev.popper, next.popper);\n    var isArrowEqual = dequal(prev.arrow, next.arrow);\n    if (isArrowEqual && isPopperEqual) return prev;\n    return next;\n  };\n}\n\nvar EMPTY_MODIFIERS = [];\nexport function usePopper(referenceElement, popperElement, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var prevOptions = React.useRef(null);\n  var optionsWithDefaults = {\n    onFirstUpdate: options.onFirstUpdate,\n    placement: options.placement || \"bottom\",\n    strategy: options.strategy || \"absolute\",\n    modifiers: options.modifiers || EMPTY_MODIFIERS\n  };\n  var [styles, setStyles] = React.useState({\n    popper: {\n      position: optionsWithDefaults.strategy,\n      left: \"0\",\n      top: \"0\"\n    }\n  });\n  var [attrs, setAttrs] = React.useState({});\n  var updateStateModifier = React.useMemo(() => ({\n    name: \"updateState\",\n    enabled: true,\n    phase: \"write\",\n    fn: _ref => {\n      var {\n        state\n      } = _ref;\n      var elements = Object.keys(state.elements);\n      setStyles(resolve(state.styles, elements));\n      setAttrs(resolve(state.attributes, elements));\n    },\n    requires: [\"computeStyles\"]\n  }), []);\n  var popperOptions = React.useMemo(() => {\n    var newOptions = {\n      onFirstUpdate: optionsWithDefaults.onFirstUpdate,\n      placement: optionsWithDefaults.placement,\n      strategy: optionsWithDefaults.strategy,\n      modifiers: [...optionsWithDefaults.modifiers, updateStateModifier, {\n        name: \"applyStyles\",\n        enabled: false\n      }]\n    };\n\n    if (dequal(prevOptions.current, newOptions)) {\n      return prevOptions.current || newOptions;\n    }\n\n    prevOptions.current = newOptions;\n    return newOptions;\n  }, [optionsWithDefaults.onFirstUpdate, optionsWithDefaults.placement, optionsWithDefaults.strategy, optionsWithDefaults.modifiers, updateStateModifier]);\n  var popperInstanceRef = React.useRef();\n  useSafeLayoutEffect(() => {\n    if (popperInstanceRef.current) {\n      popperInstanceRef.current.setOptions(popperOptions);\n    }\n  }, [popperOptions]);\n  useSafeLayoutEffect(() => {\n    if (referenceElement == null || popperElement == null) {\n      return;\n    }\n\n    var createPopper = options.createPopper || defaultCreatePopper;\n    var popperInstance = createPopper(referenceElement, popperElement, popperOptions);\n    popperInstanceRef.current = popperInstance;\n    return () => {\n      popperInstance.destroy();\n      popperInstanceRef.current = null;\n    };\n  }, [referenceElement, popperElement, options.createPopper]);\n  React.useEffect(() => {\n    var id = requestAnimationFrame(() => {\n      var _popperInstanceRef$cu;\n\n      (_popperInstanceRef$cu = popperInstanceRef.current) == null ? void 0 : _popperInstanceRef$cu.forceUpdate();\n    });\n    return () => {\n      cancelAnimationFrame(id);\n    };\n  }, []);\n  return {\n    state: popperInstanceRef.current ? popperInstanceRef.current.state : null,\n    styles,\n    attributes: attrs,\n    update: popperInstanceRef.current ? popperInstanceRef.current.update : null,\n    forceUpdate: popperInstanceRef.current ? popperInstanceRef.current.forceUpdate : null\n  };\n}","map":{"version":3,"sources":["../../src/react-popper.ts"],"names":["createPopper","prev","next","fromEntries","elements","element","obj","isPopperEqual","dequal","isArrowEqual","EMPTY_MODIFIERS","options","prevOptions","React","optionsWithDefaults","onFirstUpdate","placement","strategy","modifiers","popper","position","left","top","updateStateModifier","name","enabled","phase","fn","state","Object","setStyles","resolve","setAttrs","requires","popperOptions","newOptions","popperInstanceRef","useSafeLayoutEffect","referenceElement","popperElement","popperInstance","id","requestAnimationFrame","cancelAnimationFrame","attributes","update","forceUpdate"],"mappings":"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","sourcesContent":["import { useSafeLayoutEffect } from \"@chakra-ui/hooks\"\nimport { fromEntries } from \"@chakra-ui/utils\"\nimport {\n  createPopper as defaultCreatePopper,\n  Instance,\n  Modifier,\n  Options as PopperOptions,\n  VirtualElement,\n} from \"@popperjs/core\"\nimport { dequal } from \"dequal\"\nimport * as React from \"react\"\n\ntype Options = Partial<PopperOptions> & {\n  createPopper?: typeof defaultCreatePopper\n}\n\ntype State = {\n  styles: {\n    [key: string]: Partial<React.CSSProperties>\n  }\n  attributes: {\n    [key: string]: { [key: string]: string }\n  }\n}\n\nfunction resolve(obj: any, elements: string[]) {\n  return (prev: any) => {\n    const next = fromEntries(\n      elements.map((element) => [element, obj[element]]),\n    ) as any\n\n    const isPopperEqual = dequal(prev.popper, next.popper)\n    const isArrowEqual = dequal(prev.arrow, next.arrow)\n\n    if (isArrowEqual && isPopperEqual) return prev\n    return next\n  }\n}\n\nconst EMPTY_MODIFIERS: any[] = []\n\nexport function usePopper(\n  referenceElement: Element | VirtualElement,\n  popperElement: HTMLElement,\n  options: Options = {},\n) {\n  const prevOptions = React.useRef<any>(null)\n\n  const optionsWithDefaults = {\n    onFirstUpdate: options.onFirstUpdate,\n    placement: options.placement || \"bottom\",\n    strategy: options.strategy || \"absolute\",\n    modifiers: options.modifiers || EMPTY_MODIFIERS,\n  }\n\n  const [styles, setStyles] = React.useState<State[\"styles\"]>({\n    popper: {\n      position: optionsWithDefaults.strategy,\n      left: \"0\",\n      top: \"0\",\n    },\n  })\n\n  const [attrs, setAttrs] = React.useState<State[\"attributes\"]>({})\n\n  const updateStateModifier: Modifier<\"updateState\", any> = React.useMemo(\n    () => ({\n      name: \"updateState\",\n      enabled: true,\n      phase: \"write\",\n      fn: ({ state }) => {\n        const elements = Object.keys(state.elements)\n        setStyles(resolve(state.styles, elements))\n        setAttrs(resolve(state.attributes, elements))\n      },\n      requires: [\"computeStyles\"],\n    }),\n    [],\n  )\n\n  const popperOptions = React.useMemo(() => {\n    const newOptions = {\n      onFirstUpdate: optionsWithDefaults.onFirstUpdate,\n      placement: optionsWithDefaults.placement,\n      strategy: optionsWithDefaults.strategy,\n      modifiers: [\n        ...optionsWithDefaults.modifiers,\n        updateStateModifier,\n        { name: \"applyStyles\", enabled: false },\n      ],\n    }\n\n    if (dequal(prevOptions.current, newOptions)) {\n      return prevOptions.current || newOptions\n    }\n\n    prevOptions.current = newOptions\n    return newOptions\n  }, [\n    optionsWithDefaults.onFirstUpdate,\n    optionsWithDefaults.placement,\n    optionsWithDefaults.strategy,\n    optionsWithDefaults.modifiers,\n    updateStateModifier,\n  ])\n\n  const popperInstanceRef = React.useRef<Instance | null>()\n\n  useSafeLayoutEffect(() => {\n    if (popperInstanceRef.current) {\n      popperInstanceRef.current.setOptions(popperOptions)\n    }\n  }, [popperOptions])\n\n  useSafeLayoutEffect(() => {\n    if (referenceElement == null || popperElement == null) {\n      return\n    }\n\n    const createPopper = options.createPopper || defaultCreatePopper\n    const popperInstance = createPopper(\n      referenceElement,\n      popperElement,\n      popperOptions,\n    )\n\n    popperInstanceRef.current = popperInstance\n\n    return () => {\n      popperInstance.destroy()\n      popperInstanceRef.current = null\n    }\n  }, [referenceElement, popperElement, options.createPopper])\n\n  React.useEffect(() => {\n    const id = requestAnimationFrame(() => {\n      popperInstanceRef.current?.forceUpdate()\n    })\n    return () => {\n      cancelAnimationFrame(id)\n    }\n  }, [])\n\n  return {\n    state: popperInstanceRef.current ? popperInstanceRef.current.state : null,\n    styles,\n    attributes: attrs,\n    update: popperInstanceRef.current ? popperInstanceRef.current.update : null,\n    forceUpdate: popperInstanceRef.current\n      ? popperInstanceRef.current.forceUpdate\n      : null,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}